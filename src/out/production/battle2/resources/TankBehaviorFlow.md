## 배틀싸피 3탱크 행동 로직 플로우

### 공통 개념
- **사거리**: 3칸, 상하좌우 직선만 유효
- **차폐 규칙**: `R/T`는 포탄 차단, `W`는 이동 불가이나 포탄은 관통
- **탄약**: 일반(30) 99발 기본, 메가(70)는 `F`에서 카이사르 해독 성공 시 획득
- **전술 원칙**: 초반 `F` 확보로 메가포탄 수급 → 진영 구축 → 교차각 형성 후 집중 사격
- **경로 탐색**: A* 예정(현 BFS). 비용 = 기본 이동 + 위험 가중치 + `T` 파괴 비용. `R/W` 진입 불가 반영
- **위험 맵**: 적 사거리 3 직선 가시 라인 타일에 가중치(진입 최소화)
- **LoS 규칙**: 상하좌우 스캔 시 `R/T`에서 차단, `W`는 무시(포탄 관통)
- **T 파괴 정책**: 즉시 킬/포탑 각 형성 또는 큰 지형 이득일 때만 최소 횟수로 제거

### 턴 루프(공통)
1) 입력 파싱 → 맵/유닛/탄 보유 갱신 → 위험 맵 업데이트
2) 사거리 3·직선·무차폐 확정 명중이면 사격, 아니면 이동/해독/재배치
3) 목표 선택: 체력 낮은 적 → 전장 영향 큰 적 → 포탑(X) 각 확보 시 전환
4) 아군 간 다음 턴 점유 타일 예약으로 충돌/끼임 방지

---

## Tank1 — 개척/정찰(Breach & Scout)

### 목표
- 최근접 `F` 도달 및 해독 성공으로 메가포탄 선점
- 최소 `T` 파괴로 통로 개방, 엄폐 인접 타일에서 사거리 3 교전각 확보

### 오프닝(초반)
1) A*로 최근접 `F`를 목표 설정(우회 vs `T` 파괴 비용 비교)
2) `F` 도달 즉시 카이사르 해독(메가포탄 확보)
3) 이동 중 확정 명중 각이면 사격, 아니면 경로 유지

### 중반
- 개방 루트 활용, 엄폐 모서리-피킹 위치 선점
- 아군과 교차각 형성(같은 목표를 다른 각에서 3칸 직선)
- 필요 시 최소 횟수 `T` 제거로 즉시 사격각 생성

### 종반
- 포탑(X) 혹은 잔존 적에 대한 빠른 각 전환
- 과노출 시 1칸 후퇴로 엄폐 재확보

### 의사결정 플로우(턴별)
1) 사격 가능? → 사격
2) `F` 위이며 미해독? → 해독
3) 목표 위치(엄폐 인접 + 사거리 3 각)로 A* 이동
4) 경로가 `T`로 막힘? → 우회 비용 > 파괴 비용이면 `T` 제거 후 전진

---

## Tank2 — 지역 통제/엄호(Control & Anchor)

### 목표
- 초크포인트 장악, `F` 점거 아군 엄호, 오버워치로 적 진입 억제

### 오프닝(초반)
1) 아군 `F` 경로 상 초크 인접 엄폐 타일 선점(A*)
2) 사거리 3 직선 라인 유지, 확정 명중만 사격
3) 아군 해독 중에는 노출 경로 차단 각 고정

### 중반
- 교차사격 라인 유지, 적 돌파를 사거리 3에서 차단
- 더 유리한 앵커 포지션이 보이면 소폭 재배치(불필요한 전진 금지)
- 필요 시 최소 `T` 제거로 시야선 개선

### 종반
- 포탑(X) 각 확보 시 전환 사격, 잔존 적 봉쇄
- 체력 임계 시 후퇴로 생존 우선

### 의사결정 플로우(턴별)
1) 확정 명중 가능? → 사격
2) 방어 각이 무너짐? → 인접 최적 앵커 타일 재배치
3) 아군 킬각? → 동일 목표 교차각 맞춤
4) `T` 제거가 각을 크게 개선? → 최소 횟수 제거

---

## Tank3 — 측면/마무리(Flank & Finish)

### 목표
- 측후면 각으로 차폐 우회, 메가포탄 기반 집중 포화로 마무리

### 오프닝(초반)
1) 두 번째로 가까운 `F` 또는 측면 경유 타일로 A* 이동
2) 기회가 좋다면 `F` 해독 보조로 메가포탄 추가 수급

### 중반
- Tank1 개방 루트로 측면 각 확보(사거리 3, 무차폐)
- 체력 낮은 적 우선, 70+30 2턴 킬 각 최우선

### 종반
- 포탑(X) 혹은 잔존 적에 메가포탄 우선 사용(확정/준확정)
- 위험 노출 시 짧은 후퇴로 각 유지

### 의사결정 플로우(턴별)
1) 메가포탄 보유 + 확정 명중? → 메가포탄 사격
2) 일반포탄 2턴 킬 라인(교차 포함)? → 사격
3) 측면 목표 타일(엄폐 인접 + 무차폐 라인)로 A* 이동
4) `T` 지연이 크면 최소 제거 후 각 형성

---

## A* 비용 설계(요약)
- 기본 이동: 1
- 위험 가중치: 적 사거리 3 라인 +α, 적 근접 추가 +β
- `T` 파괴 비용: 예상 소모 턴/탄으로 내재화(+3~5 예시)
- 보너스: 엄폐 인접, 교차사격 형성 타일 -γ

## 사격/타깃 선택 규칙(요약)
- 확정 명중 우선(사거리 3·직선·무차폐)
- 메가포탄: 확정/준확정 킬, 포탑 각, 큰 전세 이득에 사용
- 우선순위: 체력 낮은 적 → 전장 영향 큰 적 → 포탑(X)

## 협업 규칙(요약)
- Tank1: "경로 개방/해독 완료" → Tank2: "오버워치 유지" → Tank3: "측면 도달/사격"
- 같은 목표에 서로 다른 각의 사거리 3 직선 라인 동시 진입(크로스파이어)

---

## T 파괴 의사결정(상세)
- **목적**: (1) 통로 개방, (2) 즉시 유효 사격각 형성(사거리 3 직선, 무차폐)
- **비용 모델**: `C_destroy = 예상 필요탄수 × 1턴 + 노출 패널티(위험 가중치)`
  - 기본은 일반 포탄으로 제거(메가는 교전용 보존)
  - A*에서 `T` 타일을 통과 가능으로 간주하되 가중치 `+C_destroy` 부여 → 우회 경로 비용과 자동 비교
- **파괴 허용 조건**:
  - 파괴 직후 2턴 킬(70+30 또는 30×3)·포탑(X) 각이 열림
  - 팀 합류/탈출 지연이 우회보다 더 큼(전선 전개 이득이 큼)
  - 적이 `T` 뒤에 있고 1~2발로 길이 열리며 아군 교차각 보장
- **파괴 금지 조건**:
  - 개방이 적에게 더 유리한 각/돌파 경로 제공
  - 적이 먼저 해당 개방 지점에 도달/장악 가능한 상황

## 메가포탄 수급 정책(상세)
- **파라미터(튜닝 대상)**
  - `MEGA_TARGET_PER_TANK`(기본 2): 각 탱크가 초반 목표로 확보할 메가 수
  - `TEAM_MEGA_MIN_RESERVE`(기본 3): 팀 최소 보유량, 미만 시 보급 우선
- **운용 규칙**
  - 초반: Tank1·Tank3 각각 1회 해독 목표, Tank2는 엄호(여유 시 1회)
  - 교전 중: 확정/준확정 킬·포탑 각이 없고 팀 보유 < 최소치 → 인접 `F` 경유 재보급
  - 사용 우선순위: 확정/준확정 킬, 포탑(X) 타격, 게임 전세 크게 바뀌는 교전
  - 해독 절차: `F` 도달 즉시 제공 코드로 해독 시도 → 성공 확인 후 복귀 경로 A* 재계산

## 동적 위치/재배치 로직(상세)
- **실시간 위험 맵**: 매 턴 적 좌표·방향 기반 사거리 3 직선 라인에 가중치 갱신, 다음 턴 도달 가능 칸에도 소폭 가중치
- **재배치 트리거**
  - 적이 사거리 3 직선으로 노출 → 엄폐 모서리-피킹으로 슬라이드 이동(좌/우/후퇴 1칸)
  - 더 높은 가치 타깃(체력 낮음/포탑 각)이 생김 → 목표 타일 즉시 갱신 후 A*
  - 아군 타일 예약 충돌 감지 → 대체 후보 타일로 재계획
- **행동 원칙**
  - 사격 가능 시 이동보다 사격 우선
  - 이동은 매 턴 A* 목적 타일 재산정(완전 동적 계획)
  - 앵커 유지 vs 전진: 이득 임계값(교차각/킬 기대값)이 넘을 때만 전진
  - 퇴각 조건: 체력 임계 또는 다중 LoS 노출 시 1칸 후퇴로 각 재구성

---

## 정밀 파라미터 업데이트
- **T 파괴**: 일반 포탄 1발로 파괴(확정). 메가포탄은 `T` 제거에 사용하지 않음(예외적 전세 역전 상황만 고려).
- **A*** 비용 반영: `T` 파괴 비용 = 1턴(사격 1회) + 노출 패널티(위험 가중치). 기존의 가변 탄수 가정은 제거.
